<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>RampFuel Growth Assessment Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=League+Spartan:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <style>
    body {
      font-family: "League Spartan", sans-serif;
      color: #340299;
      background: #f5f5f7;
      margin: 0;
      padding: 40px 16px;
    }

    .rf-container {
      max-width: 720px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 32px 24px 28px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
    }

    .rf-header {
      margin-bottom: 10px;
    }

    .rf-header h1 {
      margin: 0 0 6px;
      font-size: 1.6rem;
    }

    .rf-header p {
      margin: 0;
      color: #64748b;
      font-size: 0.95rem;
    }

    .rf-progress-bar {
      margin: 16px 0 10px;
      font-size: 0.85rem;
      color: #475569;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rf-progress-text-main {
      font-weight: 500;
    }

    .rf-pill {
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      font-size: 0.78rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .rf-pill--complete {
      background: #ecfdf3;
      color: #166534;
    }

    .rf-progress-meter {
      position: relative;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .rf-progress-meter-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, #4f46e5, #22c55e);
      transition: width 0.25s ease-out;
    }

    /* Section breakdown panel */
    .rf-section-wrapper {
      margin-top: 24px;
      padding-top: 20px;
      font-size: 0.9rem;
      border-bottom: 3px solid transparent;
      border-image: linear-gradient(90deg,#340299, #f1ebff) 1;
    }

    .rf-section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      margin-bottom: 4px;
    }

    .rf-section-header-title {
      font-weight: 500;
      color: #111827;
    }

    .rf-section-toggle-btn {
      border: none;
      outline: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 4px 10px;
      font-size: 0.75rem;
      background: #f3f4ff;
      color: #4f46e5;
      display: inline-flex;
      align-items: center;
      gap: 4px;
    }

    .rf-section-toggle-btn:hover {
      background: #e0e3ff;
    }

    .rf-section-list {
      margin-top: 4px;
    }

    .rf-section-list.rf-section-list--hidden {
      display: none;
    }

    .rf-section-row {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-top: 4px;
      gap: 8px;
    }

    .rf-section-name {
      font-weight: 500;
      color: #1f2933;
    }

    .rf-section-count {
      white-space: nowrap;
    }

    .rf-section-complete {
      color: #166534;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="rf-container">
    <div class="rf-header">
      <h1 style="font-size: 2.2rem;">RampFuel Growth Assessment</h1>
      <p>
        Please complete the questions below. Your progress updates as you answer.
      </p>
    </div>

    <!-- Overall progress -->
    <div class="rf-progress-bar">
      <div class="rf-progress-text-main" id="rf-progress-main">
        Progress will appear once the questions finish loading.
      </div>
      <div class="rf-pill" id="rf-progress-pill">No questions detected yet</div>
      <div class="rf-progress-meter">
        <div class="rf-progress-meter-fill" id="rf-progress-fill"></div>
      </div>
    </div>

    <!-- Per-section progress (collapsible) -->
    <div class="rf-section-wrapper">
      <div class="rf-section-header">
        <div class="rf-section-header-title">Section breakdown</div>
        <button
          type="button"
          id="rf-section-toggle"
          class="rf-section-toggle-btn"
          aria-expanded="true"
        >
          Hide section breakdown
        </button>
      </div>
      <div class="rf-section-list" id="rf-section-list">
        <!-- section rows injected via JS -->
      </div>
    </div>

    <!-- HubSpot form will be injected into this container by the developer script -->
    <div id="rf-form-root">
      <!-- Your HubSpot developer embed code -->
      <p>

      </p>
      <p>
        
      </p>
      <script src="https://js-na2.hsforms.net/forms/embed/developer/242714090.js" defer></script>
      <div
        id="rf-hs-form-container"
        class="hs-form-html"
        data-region="na2"
        data-form-id="3a22e97e-7db8-4dd4-ab93-8ed70c797dd9"
        data-portal-id="242714090"
      ></div>
    </div>
  </div>
  <script>
  // Group questions by nearest <h2> above them
  function setupFormProgressWithSections(formEl) {
    if (!formEl) return;

    var progressMain = document.getElementById("rf-progress-main");
    var progressPill = document.getElementById("rf-progress-pill");
    var progressFill = document.getElementById("rf-progress-fill");
    var sectionList = document.getElementById("rf-section-list");
    var sectionToggle = document.getElementById("rf-section-toggle");

    // ---------------------------
    // LOCAL STORAGE SAVE/RESTORE
    // ---------------------------
    var STORAGE_KEY = "rf_growth_assessment_progress_v1";

    function getAllQuestionInputs() {
      return Array.from(
        formEl.querySelectorAll("input, select, textarea")
      ).filter(function (input) {
        var type = (input.type || "").toLowerCase();
        if (
          type === "hidden" ||
          type === "submit" ||
          type === "button" ||
          input.disabled
        ) {
          return false;
        }
        var style = window.getComputedStyle(input);
        return style.display !== "none" && style.visibility !== "hidden";
      });
    }

    function saveProgress() {
      var inputs = getAllQuestionInputs();
      var draft = {};

      inputs.forEach(function (input) {
        var name = input.name || input.id;
        if (!name) return;

        var type = (input.type || "").toLowerCase();

        if (type === "checkbox") {
          if (!draft[name]) draft[name] = [];
          if (input.checked) {
            draft[name].push(input.value || "__on__");
          }
        } else if (type === "radio") {
          if (input.checked) {
            draft[name] = input.value || "";
          }
        } else {
          draft[name] = input.value || "";
        }
      });

      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(draft));
      } catch (e) {}
    }

    function loadProgress() {
      var raw = null;
      try {
        raw = localStorage.getItem(STORAGE_KEY);
      } catch (e) {
        return;
      }
      if (!raw) return;

      var data = {};
      try {
        data = JSON.parse(raw);
      } catch (e) {
        return;
      }

      var inputs = getAllQuestionInputs();
      inputs.forEach(function (input) {
        var name = input.name || input.id;
        if (!name || data[name] == null) return;

        var saved = data[name];
        var type = (input.type || "").toLowerCase();

        if (type === "checkbox") {
          var arr = Array.isArray(saved) ? saved : [saved];
          var val = input.value || "__on__";
          input.checked = arr.indexOf(val) !== -1;
        } else if (type === "radio") {
          input.checked = saved === (input.value || "");
        } else {
          input.value = saved;
        }
      });
    }

    // Clear saved draft on submit
    formEl.addEventListener("submit", function () {
      try {
        localStorage.removeItem(STORAGE_KEY);
      } catch (e) {}
    });

    // ---------------------------
    // SECTION TOGGLE BEHAVIOR
    // ---------------------------
    (function initToggle() {
      if (!sectionList || !sectionToggle) return;

      var STORAGE_KEY_TOGGLE = "rf_section_breakdown_hidden";

      function applyState(hidden) {
        if (hidden) {
          sectionList.classList.add("rf-section-list--hidden");
          sectionToggle.textContent = "Show section breakdown";
          sectionToggle.setAttribute("aria-expanded", "false");
        } else {
          sectionList.classList.remove("rf-section-list--hidden");
          sectionToggle.textContent = "Hide section breakdown";
          sectionToggle.setAttribute("aria-expanded", "true");
        }
      }

      var saved = null;
      try {
        saved = localStorage.getItem(STORAGE_KEY_TOGGLE);
      } catch (e) {}
      var initiallyHidden = saved === "1";
      applyState(initiallyHidden);

      sectionToggle.addEventListener("click", function () {
        var isHidden = sectionList.classList.contains("rf-section-list--hidden");
        var newHidden = !isHidden;
        applyState(newHidden);
        try {
          localStorage.setItem(STORAGE_KEY_TOGGLE, newHidden ? "1" : "0");
        } catch (e) {}
      });
    })();

    // ---------------------------
    // PROGRESS + SECTION LOGIC
    // ---------------------------

    function getSectionHeadings() {
      return Array.from(formEl.querySelectorAll("h2")).filter(function (h) {
        var txt = (h.innerText || "").trim();
        if (!txt) return false;
        var style = window.getComputedStyle(h);
        return style.display !== "none" && style.visibility !== "hidden";
      });
    }

    function findNearestH2Above(el, h2s) {
      var current = el;
      while (current && current !== formEl) {
        var sibling = current.previousElementSibling;
        while (sibling) {
          if (h2s.indexOf(sibling) !== -1) return sibling;
          var nested = sibling.querySelector("h2");
          if (nested && h2s.indexOf(nested) !== -1) return nested;
          sibling = sibling.previousElementSibling;
        }
        current = current.parentElement;
      }
      return null;
    }

    function buildQuestionGroupsBySection() {
      var inputs = getAllQuestionInputs();
      var h2s = getSectionHeadings();
      var byName = {};

      inputs.forEach(function (input) {
        var name = input.name || input.id;
        if (!name) return;
        if (!byName[name]) {
          byName[name] = {
            name: name,
            inputs: [],
            sectionTitle: null
          };
        }
        byName[name].inputs.push(input);
      });

      var groups = Object.values(byName);

      groups.forEach(function (group) {
        var refInput = group.inputs[0];
        var heading = findNearestH2Above(refInput, h2s);
        group.sectionTitle = heading
          ? (heading.innerText || "").trim()
          : "Other";
      });

      return groups;
    }

    function isGroupAnswered(group) {
      var inputs = group.inputs;
      if (!inputs || !inputs.length) return false;

      var hasChoice = inputs.some(function (input) {
        var type = (input.type || "").toLowerCase();
        return type === "checkbox" || type === "radio";
      });

      if (hasChoice) {
        return inputs.some(function (input) {
          return input.checked;
        });
      }

      return inputs.some(function (input) {
        var val = input.value;
        return val != null && val.toString().trim() !== "";
      });
    }

    function updateProgress() {
      var groups = buildQuestionGroupsBySection();
      var totalQuestions = groups.length;
      var answeredQuestions = groups.filter(isGroupAnswered).length;

      if (totalQuestions === 0) {
        progressMain.textContent =
          "Progress will appear once the questions finish loading.";
        progressPill.textContent = "No questions detected yet";
        progressPill.classList.remove("rf-pill--complete");
        if (progressFill) progressFill.style.width = "0%";
        if (sectionList) sectionList.innerHTML = "";
        return;
      }

      // Overall counts
      progressMain.textContent =
        "Answered " + answeredQuestions + " / " + totalQuestions + " questions";

      var ratio = answeredQuestions / totalQuestions;
      var percent = Math.round(ratio * 100);

      if (answeredQuestions === totalQuestions) {
        progressPill.textContent = "All questions completed";
        progressPill.classList.add("rf-pill--complete");
      } else {
        progressPill.textContent = percent + "% of questions answered";
        progressPill.classList.remove("rf-pill--complete");
      }

      if (progressFill) {
        progressFill.style.width = percent + "%";
      }

      // Per-section breakdown
      if (sectionList) {
        var bySection = {};
        groups.forEach(function (g) {
          var title = g.sectionTitle || "Other";
          if (!bySection[title]) {
            bySection[title] = { title: title, total: 0, answered: 0 };
          }
          bySection[title].total += 1;
          if (isGroupAnswered(g)) {
            bySection[title].answered += 1;
          }
        });

        var sections = Object.values(bySection);
        var h2s = getSectionHeadings();

        sections.sort(function (a, b) {
          var idxA = h2s.findIndex(function (h) {
            return (h.innerText || "").trim() === a.title;
          });
          var idxB = h2s.findIndex(function (h) {
            return (h.innerText || "").trim() === b.title;
          });
          return idxA - idxB;
        });

        var html = "";
        sections.forEach(function (s) {
          var complete = s.answered === s.total && s.total > 0;
          html +=
            '<div class="rf-section-row">' +
            '<div class="rf-section-name">' +
            s.title +
            "</div>" +
            '<div class="rf-section-count' +
            (complete ? " rf-section-complete" : "") +
            '">';
          html += s.answered + " / " + s.total;
          html += "</div></div>";
        });

        sectionList.innerHTML = html;
      }
    }

    // Save + update progress on input/change
    formEl.addEventListener(
      "input",
      function () {
        saveProgress();
        updateProgress();
      },
      true
    );

    formEl.addEventListener(
      "change",
      function () {
        saveProgress();
        updateProgress();
      },
      true
    );

    // Watch for HubSpot injecting fields
    var obs = new MutationObserver(function () {
      updateProgress();
    });

    obs.observe(formEl, {
      childList: true,
      subtree: true
    });

    // Restore previous answers before first calculation
    loadProgress();
    updateProgress();
  }

  // Wait for HubSpot form
  document.addEventListener("DOMContentLoaded", function () {
    var container = document.getElementById("rf-hs-form-container");
    if (!container) return;

    function tryAttach() {
      var form = container.querySelector("form");
      if (form) {
        setupFormProgressWithSections(form);
        return true;
      }
      return false;
    }

    if (!tryAttach()) {
      var observer = new MutationObserver(function () {
        if (tryAttach()) {
          observer.disconnect();
        }
      });

      observer.observe(container, {
        childList: true,
        subtree: true
      });
    }
  });
</script>
</body>
</html>
