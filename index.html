<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>RampFuel Growth Assessment Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 40px 16px;
    }

    .rf-container {
      max-width: 720px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 32px 24px 28px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
    }

    .rf-header {
      margin-bottom: 10px;
    }

    .rf-header h1 {
      margin: 0 0 6px;
      font-size: 1.6rem;
    }

    .rf-header p {
      margin: 0;
      color: #64748b;
      font-size: 0.95rem;
    }

    .rf-progress-bar {
      margin: 16px 0 10px;
      font-size: 0.85rem;
      color: #475569;
      display: flex;
      flex-direction: column;
      gap: 6px;
    }

    .rf-progress-text-main {
      font-weight: 500;
    }

    .rf-pill {
      align-self: flex-start;
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      font-size: 0.78rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .rf-pill--complete {
      background: #ecfdf3;
      color: #166534;
    }

    .rf-progress-meter {
      position: relative;
      width: 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
    }

    .rf-progress-meter-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, #4f46e5, #22c55e);
      transition: width 0.25s ease-out;
    }
  </style>
</head>
<body>
  <div class="rf-container">
    <div class="rf-header">
      <h1>RampFuel Growth Assessment</h1>
      <p>
        Please complete the questions below. Your progress updates as you answer.
      </p>
    </div>

    <div class="rf-progress-bar">
      <div class="rf-progress-text-main" id="rf-progress-main">
        Loading progress…
      </div>
      <div class="rf-pill" id="rf-progress-pill">–</div>
      <div class="rf-progress-meter">
        <div class="rf-progress-meter-fill" id="rf-progress-fill"></div>
      </div>
    </div>

    <!-- HubSpot form will be injected here -->
    <div id="rf-form-root"></div>
  </div>

  <!-- HubSpot forms library -->
  <script
    charset="utf-8"
    type="text/javascript"
    src="https://js.hsforms.net/forms/embed/v2.js"
  ></script>

  <script>
    // Normalize HubSpot's $form into a plain DOM element
    function normalizeFormElement($form) {
      if (!$form) return null;
      if ($form.get && typeof $form.get === "function") return $form.get(0);
      if ($form instanceof HTMLElement) return $form;
      if ($form[0] && $form[0] instanceof HTMLElement) return $form[0];
      return document.querySelector("form");
    }

    function setupWholeFormProgress(formEl) {
      if (!formEl) return;

      var progressMain = document.getElementById("rf-progress-main");
      var progressPill = document.getElementById("rf-progress-pill");
      var progressFill = document.getElementById("rf-progress-fill");

      // Find all "question" wrappers in the form
      function getQuestionWrappers() {
        var wrappers = Array.from(formEl.querySelectorAll(".hs-form-field"));
        return wrappers.filter(function (wrapper) {
          var inputs = Array.from(
            wrapper.querySelectorAll("input, select, textarea")
          ).filter(function (input) {
            var type = (input.type || "").toLowerCase();
            if (
              type === "hidden" ||
              type === "submit" ||
              type === "button" ||
              input.disabled
            ) {
              return false;
            }
            var style = window.getComputedStyle(input);
            return style.display !== "none" && style.visibility !== "hidden";
          });
          return inputs.length > 0;
        });
      }

      var questionWrappers = getQuestionWrappers();

      function isQuestionAnswered(wrapper) {
        var inputs = Array.from(
          wrapper.querySelectorAll("input, select, textarea")
        ).filter(function (input) {
          var type = (input.type || "").toLowerCase();
          if (
            type === "hidden" ||
            type === "submit" ||
            type === "button" ||
            input.disabled
          ) {
            return false;
          }
          var style = window.getComputedStyle(input);
          return style.display !== "none" && style.visibility !== "hidden";
        });

        if (!inputs.length) return false;

        var hasChoice = inputs.some(function (input) {
          var type = (input.type || "").toLowerCase();
          return type === "checkbox" || type === "radio";
        });

        if (hasChoice) {
          return inputs.some(function (input) {
            return input.checked;
          });
        }

        return inputs.some(function (input) {
          var val = input.value;
          return val != null && val.toString().trim() !== "";
        });
      }

      function updateProgress() {
        questionWrappers = getQuestionWrappers();

        var totalQuestions = questionWrappers.length;
        var answeredQuestions = questionWrappers.filter(isQuestionAnswered)
          .length;

        if (totalQuestions === 0) {
          progressMain.textContent =
            "Progress will appear once the questions finish loading.";
          progressPill.textContent = "No questions detected yet";
          progressPill.classList.remove("rf-pill--complete");
          if (progressFill) progressFill.style.width = "0%";
          return;
        }

        progressMain.textContent =
          "Answered " +
          answeredQuestions +
          " / " +
          totalQuestions +
          " questions";

        var ratio = answeredQuestions / totalQuestions;
        var percent = Math.round(ratio * 100);

        if (answeredQuestions === totalQuestions) {
          progressPill.textContent = "All questions completed";
          progressPill.classList.add("rf-pill--complete");
        } else {
          progressPill.textContent = percent + "% of questions answered";
          progressPill.classList.remove("rf-pill--complete");
        }

        if (progressFill) {
          progressFill.style.width = percent + "%";
        }
      }

      // Update on typing / changes
      formEl.addEventListener(
        "input",
        function () {
          updateProgress();
        },
        true
      );
      formEl.addEventListener(
        "change",
        function () {
          updateProgress();
        },
        true
      );

      // Watch for HubSpot inserting fields after onFormReady
      var obs = new MutationObserver(function () {
        updateProgress();
      });

      obs.observe(formEl, {
        childList: true,
        subtree: true,
      });

      // Initial run
      updateProgress();
    }

    // Create the HubSpot form and hook into onFormReady
    hbspt.forms.create({
      portalId: "242714090",
      formId: "3a22e97e-7db8-4dd4-ab93-8ed70c797dd9",
      target: "#rf-form-root",
      onFormReady: function ($form) {
        var formEl = normalizeFormElement($form);
        setupWholeFormProgress(formEl);
      },
    });
  </script>
</body>
</html>
