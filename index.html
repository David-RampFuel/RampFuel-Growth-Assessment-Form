<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <title>RampFuel Growth Assessment Form</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: #f5f5f7;
      margin: 0;
      padding: 40px 16px;
    }

    .rf-container {
      max-width: 720px;
      margin: 0 auto;
      background: #ffffff;
      border-radius: 12px;
      padding: 32px 24px 28px;
      box-shadow: 0 10px 30px rgba(15, 23, 42, 0.12);
    }

    .rf-header {
      margin-bottom: 10px;
    }

    .rf-header h1 {
      margin: 0 0 6px;
      font-size: 1.6rem;
    }

    .rf-header p {
      margin: 0;
      color: #64748b;
      font-size: 0.95rem;
    }

    .rf-progress-bar {
      margin: 16px 0 10px;
      font-size: 0.85rem;
      color: #475569;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 8px;
      flex-wrap: wrap;
    }

    .rf-progress-text-main {
      font-weight: 500;
    }

    .rf-pill {
      padding: 4px 10px;
      border-radius: 999px;
      background: #eef2ff;
      color: #3730a3;
      font-size: 0.78rem;
      font-weight: 500;
      white-space: nowrap;
    }

    .rf-pill--complete {
      background: #ecfdf3;
      color: #166534;
    }

    .rf-progress-meter {
      position: relative;
      flex: 1 1 100%;
      height: 6px;
      border-radius: 999px;
      background: #e5e7eb;
      overflow: hidden;
      margin-top: 6px;
    }

    .rf-progress-meter-fill {
      position: absolute;
      inset: 0;
      width: 0%;
      background: linear-gradient(90deg, #4f46e5, #22c55e);
      transition: width 0.25s ease-out;
    }
  </style>
</head>
<body>
  <div class="rf-container">
    <div class="rf-header">
      <h1>RampFuel Growth Assessment</h1>
      <p>
        Please complete each section. Your progress below updates as you answer
        questions.
      </p>
    </div>

    <div class="rf-progress-bar">
      <div class="rf-progress-text-main" id="rf-progress-main">
        Loading progress…
      </div>
      <div class="rf-pill" id="rf-progress-pill">
        –
      </div>
      <div class="rf-progress-meter">
        <div class="rf-progress-meter-fill" id="rf-progress-fill"></div>
      </div>
    </div>

    <!-- HubSpot form will be injected here -->
    <div id="rf-form-root"></div>
  </div>

  <!-- HubSpot forms library -->
  <script
    charset="utf-8"
    type="text/javascript"
    src="https://js.hsforms.net/forms/embed/v2.js"
  ></script>

  <script>
    // Helper: turn HubSpot's $form into a plain DOM element
    function normalizeFormElement($form) {
      if (!$form) return null;
      // jQuery-style object
      if ($form.get && typeof $form.get === "function") {
        return $form.get(0);
      }
      // plain element
      if ($form instanceof HTMLElement) return $form;
      // array-like
      if ($form[0] && $form[0] instanceof HTMLElement) return $form[0];
      return document.querySelector("form");
    }

    function setupSectionProgress(formEl) {
      if (!formEl) return;

      var progressMain = document.getElementById("rf-progress-main");
      var progressPill = document.getElementById("rf-progress-pill");
      var progressFill = document.getElementById("rf-progress-fill");

      // Find step/section containers
      function getStepContainers() {
        var pages = Array.from(
          formEl.querySelectorAll("[data-form-page-role='page'], .hs-form-page")
        );
        if (!pages.length) {
          return [formEl]; // treat whole form as one section
        }
        return pages;
      }

      var stepContainers = getStepContainers();

      // For each step, find question wrappers (hs-form-field) that actually contain a visible input/select/textarea
      function getQuestionsInStep(stepEl) {
        var wrappers = Array.from(stepEl.querySelectorAll(".hs-form-field"));

        return wrappers.filter(function (wrapper) {
          var inputs = Array.from(
            wrapper.querySelectorAll("input, select, textarea")
          ).filter(function (input) {
            var type = (input.type || "").toLowerCase();
            if (
              type === "hidden" ||
              type === "submit" ||
              type === "button" ||
              input.disabled
            ) {
              return false;
            }
            // ignore if not actually visible
            var style = window.getComputedStyle(input);
            return style.display !== "none" && style.visibility !== "hidden";
          });

          return inputs.length > 0;
        });
      }

      var stepQuestions = stepContainers.map(function (stepEl) {
        return getQuestionsInStep(stepEl);
      });

      function getCurrentStepIndex() {
        // New multi-step forms often tag the current page
        var explicitCurrent = formEl.querySelector(
          "[data-form-page-current='true']"
        );
        if (explicitCurrent) {
          var idx = stepContainers.indexOf(explicitCurrent);
          if (idx !== -1) return idx;
        }

        // Fallback: visible step
        for (var i = 0; i < stepContainers.length; i++) {
          var el = stepContainers[i];
          var style = window.getComputedStyle(el);
          if (style.display !== "none" && style.visibility !== "hidden") {
            return i;
          }
        }

        return 0;
      }

      function isQuestionAnswered(wrapper) {
        var inputs = Array.from(
          wrapper.querySelectorAll("input, select, textarea")
        ).filter(function (input) {
          var type = (input.type || "").toLowerCase();
          if (
            type === "hidden" ||
            type === "submit" ||
            type === "button" ||
            input.disabled
          ) {
            return false;
          }
          var style = window.getComputedStyle(input);
          return style.display !== "none" && style.visibility !== "hidden";
        });

        if (!inputs.length) return false;

        // Checkbox/radio: consider answered if any checked
        var hasChoice = inputs.some(function (input) {
          var type = (input.type || "").toLowerCase();
          return type === "checkbox" || type === "radio";
        });

        if (hasChoice) {
          var anyChecked = inputs.some(function (input) {
            return input.checked;
          });
          return anyChecked;
        }

        // Other inputs: answered if value not empty
        return inputs.some(function (input) {
          var val = input.value;
          return val != null && val.toString().trim() !== "";
        });
      }

      function updateProgress() {
        var totalSteps = stepContainers.length;
        var currentStepIndex = getCurrentStepIndex();
        var currentStepNumber = currentStepIndex + 1;

        var questions = stepQuestions[currentStepIndex] || [];
        var totalQuestions = questions.length;

        var answeredQuestions = questions.filter(isQuestionAnswered).length;

        // Build text
        if (totalSteps > 1) {
          progressMain.textContent =
            "Step " +
            currentStepNumber +
            " of " +
            totalSteps +
            " · Answered " +
            answeredQuestions +
            " / " +
            totalQuestions +
            " questions in this section";
        } else {
          progressMain.textContent =
            "Answered " +
            answeredQuestions +
            " / " +
            totalQuestions +
            " questions";
        }

        // Pill + bar color
        if (totalQuestions === 0) {
          progressPill.textContent = "No questions detected in this section";
          progressPill.classList.remove("rf-pill--complete");
          if (progressFill) progressFill.style.width = "0%";
          return;
        }

        var ratio = answeredQuestions / totalQuestions;
        var percent = Math.round(ratio * 100);

        if (answeredQuestions === totalQuestions && totalQuestions > 0) {
          progressPill.textContent = "Section complete";
          progressPill.classList.add("rf-pill--complete");
        } else {
          progressPill.textContent = percent + "% of this section answered";
          progressPill.classList.remove("rf-pill--complete");
        }

        if (progressFill) {
          progressFill.style.width = percent + "%";
        }
      }

      // Update on any change / input
      formEl.addEventListener(
        "input",
        function () {
          updateProgress();
        },
        true
      );
      formEl.addEventListener(
        "change",
        function () {
          updateProgress();
        },
        true
      );

      // Watch for step changes (Next/Back) or HubSpot re-renders
      var obs = new MutationObserver(function () {
        // re-detect steps and questions, then update
        stepContainers = getStepContainers();
        stepQuestions = stepContainers.map(function (stepEl) {
          return getQuestionsInStep(stepEl);
        });
        updateProgress();
      });

      obs.observe(formEl, {
        childList: true,
        subtree: true,
      });

      // Initial run
      updateProgress();
    }

    // Create the HubSpot form and hook into onFormReady
    hbspt.forms.create({
      portalId: "242714090",
      formId: "3a22e97e-7db8-4dd4-ab93-8ed70c797dd9",
      target: "#rf-form-root",
      onFormReady: function ($form) {
        var formEl = normalizeFormElement($form);
        setupSectionProgress(formEl);
      },
    });
  </script>
</body>
</html>
